<!DOCTYPE html>
<html>

<head>
    <title>CO2 Emission Prediction Result</title>
    <!--bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>

</head>

<body>
    <div class="container">
        <div class="row mt-5">
            <div class="container alert-info">
                <h1>CO2 Emission Prediction Result by {{name}}</h1>
                
                <p>
                    {{result_data|safe}}
                </p>

                <p>
                    Total CO2 emission: {{total_emission|safe}}
                </p>

            </div>
        </div>

        <div class="row mt-5">
            <div class="container alert-primary">
                <h1>Existing CO2 emission data</h1>
                <p id="alldata">
                </p>
            </div>
        </div>
    </div>


</body>

<script>
    var result = {{ edj| safe}};
    console.log(result);

    const uniqueSupplierNames = [...new Set(result.data.map(row => row[result.columns.indexOf("Supplier_Name")]))];
    console.log(uniqueSupplierNames);
    const uniqueCommodityNames = [...new Set(result.data.map(row => row[result.columns.indexOf("Commodity_Name")]))];
    console.log(uniqueCommodityNames);

    const split_data_dict = {};
    if (uniqueCommodityNames.length == 1) {
        t_emi = 0;
        t_qa = 0;
        t_dis = 0;
        uniqueSupplierNames.forEach(suppliername => {
            
            split_data_dict[suppliername] = [];
            var sum_emi_7 = 0;
            var sum_qa_3 = 0;
            var sum_dis_6 = 0;
            result.data.forEach(row => {
                if (row[0] == suppliername) {
                    split_data_dict[suppliername].push(row);
                    sum_emi_7 += row[7];
                    sum_dis_6 += row[6];
                    sum_qa_3 += row[3];
                    t_emi += row[7];
                    t_dis += row[6];
                    t_qa += row[3];
                }
            })
            let total_data = `
                                <table class="table table-bordered border-primary">
                                    <tr>
                                        <th>summary</>                                       
                                        <td>quantity: ${sum_qa_3}</td>                                       
                                        <td>distance: ${sum_dis_6}</td>
                                        <td>emission: ${sum_emi_7}</td>
                                    </tr>
                                </table>
                            `;
            const j_d = generateHTMLTable(split_data_dict[suppliername], result.columns)
            document.getElementById('alldata').innerHTML += '<br>' + j_d + total_data;


        })
        let final_data = `
                        <table class="table table-bordered border-primary">
                            <tr>
                                <th>summary all </>                                           
                                <td>quantity: ${t_qa}</td>                                            
                                <td>distance: ${t_dis}</td>
                                <td>emission: ${t_emi}</td>
                            </tr>
                        </table>
                        `;

        
        var all_final_data = localStorage.getItem('total_final_data')
        all_final_data = all_final_data.replace('summary all', 'summary all data')
        document.getElementById('alldata').innerHTML += '<br>' + final_data + '<br>' + all_final_data;
    }
    else {
        t_emi = 0;
        t_qa = 0;
        t_dis = 0;
        uniqueCommodityNames.forEach(commodityname => {
            
            split_data_dict[commodityname] = [];
            var sum_emi_7 = 0;
            var sum_qa_3 = 0;
            var sum_dis_6 = 0;
            result.data.forEach(row => {
                if (row[1] == commodityname) {
                    split_data_dict[commodityname].push(row);
                    sum_emi_7 += row[7];
                    sum_dis_6 += row[6];
                    sum_qa_3 += row[3];
                    t_emi += row[7];
                    t_dis += row[6];
                    t_qa += row[3];
                }
            })
            let total_data = `
                                <table class="table table-bordered border-primary">
                                    <tr>
                                        <th>summary</>
                                        <!--
                                        <td>&nbsp;&emsp;&emsp;&emsp;</td>
                                        <td>&ensp;&emsp;&emsp;&emsp;</td>
                                        <td>&emsp;&emsp;&emsp;&emsp;</td>
                                        -->
                                        <td>quantity: ${sum_qa_3}</td>
                                        <!--
                                        <td>&emsp;&emsp;&emsp;&emsp;</td> 
                                        <td>&emsp;&emsp;&emsp;&emsp;</td>
                                        -->
                                        <td>distance: ${sum_dis_6}</td>
                                        <td>emission: ${sum_emi_7}</td>
                                    </tr>
                                </table>
                            `;
            const j_d = generateHTMLTable(split_data_dict[commodityname], result.columns)
            document.getElementById('alldata').innerHTML += '<br>' + j_d + total_data;

        })
        let final_data = `
                        <table class="table table-bordered border-primary">
                            <tr>
                                <th>summary all </>                                           
                                <td>quantity: ${t_qa}</td>                                            
                                <td>distance: ${t_dis}</td>
                                <td>emission: ${t_emi}</td>
                            </tr>
                        </table>
                        `;

        
        var all_final_data = localStorage.getItem('total_final_data')
        all_final_data = all_final_data.replace('summary all', 'summary all data')
        document.getElementById('alldata').innerHTML += '<br>' + final_data + '<br>' + all_final_data;
    }



    function generateHTMLTable(data, columns) {
        let html = '<div class="table-responsive"><table class="table table-bordered border-primary"><thead><tr>';

        // Create table header
        columns.forEach(column => {
            html += `<th>${column}</th>`;
        });

        html += '</tr></thead><tbody>';

        // Populate table body
        data.forEach(row => {
            html += '<tr>';
            row.forEach(cell => {
                html += `<td>${cell}</td>`;
            });
            html += '</tr>';
        });

        html += '</tbody></table></div>';
        return html;
    }

</script>

</html>